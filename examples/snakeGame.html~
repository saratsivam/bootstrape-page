<script src="../js/jquery.min.js"></script>
<script src="../js/canvas-graphics.js"></script>

<canvas  id="canvas" width="600" height="400"></canvas>

<script>
g = GUtil.createGraphis({target: '#canvas' });
g.clear();

	

/* */
 
g.x=0,g.y=0;g.clearLoops();
var v=5;
var gameOver = g.create('Text',{text:'Game Over',x:3,y:6,font:'Bold 50px Sans-Serif',showFill:true,fillStyle:'red'});
var msg = g.create('Text',{text:'',x:1,y:6,font:'Bold 25px Sans-Serif',showFill:true,fillStyle:'red'});
var scoreText = g.create('Text',{text:'score: 0',x:10.5,y:7,font:'20px Sans-Serif',showFill:true,fillStyle:'blue',dropShadow:false});
var snake= g.create('Tracer',{x:0,y:3,vx:v,vy:0,lineWidth:10,strokeStyle:'green',length:25,defaultLength:25,nodeLength:0.10});
var head= g.create('Rectangle',{w:0.3,h:0.3,angle:45,showFill:true,fillStyle:'yellow'});
 
 
snake.head=head;
food = g.create('Sphere',{r:0.2,x:4,y:5,});
 
for(var i=0;i<100;i++){
	snake.move().update();
}
var loopId = g.loop(function(i){
 
g.clear();	
snake.move();
 
 
isCollided=false;
$.each(snake.path.points,function(i,point){			
	if(mathUtil.distance(point,snake.position()) <0.10 && i < snake.length-5){
		isCollided=true;
		return false;
	}		
});	
 
if(mathUtil.distance(food.position(),snake.position()) < 0.2){
	snake.length+=4;
	var score = snake.length-snake.defaultLength;
	scoreText.text = 'Score: '+ score;
	food.x = mathUtil.getRand(1,11);
	food.y = mathUtil.getRand(1,7);
	food.color = colorUtil.getRandColor();
	v+=speedIncr;		
}		
 
if(isCollided){				
	g.stopLoop(loopId);	
	g.draw(gameOver);
}			
g.drawArray([food,snake,scoreText]); 
 
});
 
 g.stopLoop(loopId);
 msg.fillStyle='#fff';
 msg.text="GameControls:	up:W, down:S, left:A, right:D;";
 g.draw(msg);
 msg.fillStyle='yellow';
 msg.y-=1; msg.text = 'Press Spacebar to start';g.draw(msg);
 
 
 
 
 

keyEvents={
 
A:function(e){	
snake.vy=0;if(snake.vx==0)snake.vx=-v;		
},
D:function(e){
snake.vy=0;if(snake.vx==0)snake.vx=v;		
},
W:function(e){		
snake.vx=0;if(snake.vy==0)snake.vy=v;
},
S:function(e){	
snake.vx=0;if(snake.vy==0)snake.vy=-v;
},
spacebar:function(e){
	g.toggleLoop(loopId);	
}
};
 
keyCodes={enter:13, up:38, down:40, right:39, left:37, esc:27, spacebar:32, ctrl:17, alt:18, shift:16,  W:87,S:83,A:65,D:68};
keyCodesFnMap={13:keyEvents.enter, 38:keyEvents.up, 40:keyEvents.down, 39:keyEvents.right, 37:keyEvents.left, 27:keyEvents.esc, 32:keyEvents.spacebar, 17:keyEvents.ctrl, 18:keyEvents.alt, 16:keyEvents.shift,87:keyEvents.W,83:keyEvents.S,65:keyEvents.A,68:keyEvents.D};
$(document).keydown(function(e){
var fn = keyCodesFnMap[e.keyCode];
if(fn){
fn(e);
}
});


</script>
